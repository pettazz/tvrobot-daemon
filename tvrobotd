#!/usr/bin/python
import daemon

import os
import logging
import time

# import core.config as config

from api.server import TVRobotAPI
from api.server import APIRunner

if not os.path.exists('/var/log/tvrobotd/'): #config.TVROBOT.log_path
    os.mkdir('/var/log/tvrobotd/')

logging.basicConfig(
    level = logging.DEBUG,
    format = '%(asctime)s %(name)-12s %(levelname)-8s %(message)s',
    datefmt = '%m-%d %H:%M:%S',
    filename = '%s/tvrobotapi-%s.log' % (config.TVROBOT.log_path, str(int(time.time()))),
    filemode = 'a'
)

console = logging.StreamHandler()
console.setLevel(logging.INFO)
logging.getLogger('').addHandler(console)

logger = logging.getLogger(__name__)

log_out = open('/var/log/tvrobotd/tvrobotd.log', 'a+')
log_err = open('/var/log/tvrobotd/tvrobotd.err.log', 'a+')

context = daemon.DaemonContext(
    stdout=log_out, 
    stderr=log_err,  
    working_directory='.'
)

with context:
    APIRunner()